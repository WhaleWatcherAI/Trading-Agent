{"code":"__filename=\"/Users/coreycosta/trading-agent/lib/alpaca.ts\";(()=>{\n\"use strict\";var __defProp=Object.defineProperty;var __getOwnPropDesc=Object.getOwnPropertyDescriptor;var __getOwnPropNames=Object.getOwnPropertyNames;var __hasOwnProp=Object.prototype.hasOwnProperty;var __name=(target,value)=>__defProp(target,\"name\",{value,configurable:true});var __export=(target,all)=>{for(var name in all)__defProp(target,name,{get:all[name],enumerable:true})};var __copyProps=(to,from,except,desc)=>{if(from&&typeof from===\"object\"||typeof from===\"function\"){for(let key of __getOwnPropNames(from))if(!__hasOwnProp.call(to,key)&&key!==except)__defProp(to,key,{get:()=>from[key],enumerable:!(desc=__getOwnPropDesc(from,key))||desc.enumerable})}return to};var __toCommonJS=mod=>__copyProps(__defProp({},\"__esModule\",{value:true}),mod);var alpaca_exports={};__export(alpaca_exports,{cancelOptionOrder:()=>cancelOptionOrder,cancelOrder:()=>cancelOrder,closePosition:()=>closePosition,fetchBars:()=>fetchBars,fetchLatestQuote:()=>fetchLatestQuote,fetchOptionChain:()=>fetchOptionChain,fetchOptionExpirations:()=>fetchOptionExpirations,getAccount:()=>getAccount,getClock:()=>getClock,getOptionOrder:()=>getOptionOrder,getOrder:()=>getOrder,getPosition:()=>getPosition,listOpenOrders:()=>listOpenOrders,parseBarTime:()=>parseBarTime,sleep:()=>sleep,submitOptionOrder:()=>submitOptionOrder,submitOrder:()=>submitOrder});module.exports=__toCommonJS(alpaca_exports);var import_config=require(\"dotenv/config\");const APCA_KEY=process.env.ALPACA_KEY_ID||process.env.APCA_API_KEY_ID||\"\";const APCA_SECRET=process.env.ALPACA_SECRET_KEY||process.env.APCA_API_SECRET_KEY||\"\";const TRADING_BASE_URL=(process.env.ALPACA_BASE_URL||\"https://paper-api.alpaca.markets\").replace(/\\/$/,\"\");const DATA_BASE_URL=(process.env.ALPACA_DATA_URL||\"https://data.alpaca.markets\").replace(/\\/$/,\"\");if(!APCA_KEY||!APCA_SECRET){console.warn(\"[alpaca] Missing API credentials; set ALPACA_KEY_ID / ALPACA_SECRET_KEY\")}async function alpacaFetch(url,init={},isDataApi=false){const headers={\"APCA-API-KEY-ID\":APCA_KEY,\"APCA-API-SECRET-KEY\":APCA_SECRET,\"Content-Type\":\"application/json\",...init.headers||{}};const response=await fetch(url,{...init,headers});if(!response.ok){const text=await response.text();throw new Error(`Alpaca ${isDataApi?\"data\":\"trading\"} API error ${response.status}: ${text}`)}if(response.status===204){return{}}return response.json()}__name(alpacaFetch,\"alpacaFetch\");async function fetchBars(symbol,timeframe,options={}){const url=new URL(`${DATA_BASE_URL}/v2/stocks/${symbol}/bars`);url.searchParams.set(\"timeframe\",timeframe);url.searchParams.set(\"limit\",String(options.limit??100));url.searchParams.set(\"adjustment\",\"raw\");url.searchParams.set(\"feed\",process.env.ALPACA_DATA_FEED||\"sip\");if(options.start)url.searchParams.set(\"start\",options.start);if(options.end)url.searchParams.set(\"end\",options.end);const data=await alpacaFetch(url.toString(),void 0,true);return data.bars??[]}__name(fetchBars,\"fetchBars\");async function fetchLatestQuote(symbol){const url=`${DATA_BASE_URL}/v2/stocks/${symbol}/quotes/latest`;const data=await alpacaFetch(url,void 0,true);return data.quote??null}__name(fetchLatestQuote,\"fetchLatestQuote\");async function submitOrder(params){const url=`${TRADING_BASE_URL}/v2/orders`;return alpacaFetch(url,{method:\"POST\",body:JSON.stringify({...params,time_in_force:params.time_in_force??\"day\"})})}__name(submitOrder,\"submitOrder\");async function getOrder(orderId){const url=`${TRADING_BASE_URL}/v2/orders/${orderId}`;return alpacaFetch(url)}__name(getOrder,\"getOrder\");async function cancelOrder(orderId){const url=`${TRADING_BASE_URL}/v2/orders/${orderId}`;await alpacaFetch(url,{method:\"DELETE\"})}__name(cancelOrder,\"cancelOrder\");async function listOpenOrders(){const url=`${TRADING_BASE_URL}/v2/orders?status=open`;return alpacaFetch(url)}__name(listOpenOrders,\"listOpenOrders\");async function getPosition(symbol){try{const url=`${TRADING_BASE_URL}/v2/positions/${symbol}`;return await alpacaFetch(url)}catch(err){if(typeof err.message===\"string\"&&err.message.includes(\"404\")){return null}throw err}}__name(getPosition,\"getPosition\");async function closePosition(symbol,options={}){const url=new URL(`${TRADING_BASE_URL}/v2/positions/${symbol}`);if(options.qty)url.searchParams.set(\"qty\",options.qty);if(options.side)url.searchParams.set(\"side\",options.side);return alpacaFetch(url.toString(),{method:\"DELETE\"})}__name(closePosition,\"closePosition\");async function getClock(){const url=`${TRADING_BASE_URL}/v2/clock`;return alpacaFetch(url)}__name(getClock,\"getClock\");async function fetchOptionExpirations(symbol){const url=`${DATA_BASE_URL}/v1beta1/options/symbols/${encodeURIComponent(symbol)}/expirations`;const data=await alpacaFetch(url,void 0,true);return Array.isArray(data.expirations)?data.expirations:[]}__name(fetchOptionExpirations,\"fetchOptionExpirations\");async function fetchOptionChain(symbol,expiration,options={}){const url=new URL(`${DATA_BASE_URL}/v1beta1/options/chain/${encodeURIComponent(symbol)}`);url.searchParams.set(\"expiration\",expiration);url.searchParams.set(\"limit\",String(options.limit??250));const data=await alpacaFetch(url.toString(),void 0,true);const rawOptions=(Array.isArray(data?.options)?data.options:null)??(Array.isArray(data?.contracts)?data.contracts:null)??(Array.isArray(data?.data)?data.data:[])??[];return rawOptions.map(opt=>{const optionSymbol=opt?.symbol||opt?.id;const optionType=(opt?.option_type||opt?.type||\"\").toString().toLowerCase();const strike=Number(opt?.strike_price??opt?.strike);if(!optionSymbol||!Number.isFinite(strike)||optionType!==\"call\"&&optionType!==\"put\"){return null}const expirationDate=opt?.expiration_date||opt?.expiration||expiration;return{symbol:optionSymbol,option_type:optionType,strike_price:strike,expiration_date:expirationDate,underlying_symbol:opt?.underlying_symbol??opt?.underlying,ask_price:numericOrNull(opt?.ask??opt?.ask_price),bid_price:numericOrNull(opt?.bid??opt?.bid_price),last_trade_price:numericOrNull(opt?.last??opt?.last_price??opt?.last_trade_price),implied_volatility:numericOrNull(opt?.implied_volatility??opt?.implied_vol)}}).filter(opt=>!!opt)}__name(fetchOptionChain,\"fetchOptionChain\");function numericOrNull(value){if(value===void 0||value===null||value===\"\"){return null}const num=Number(value);return Number.isFinite(num)?num:null}__name(numericOrNull,\"numericOrNull\");async function getAccount(){const url=`${TRADING_BASE_URL}/v2/account`;return alpacaFetch(url)}__name(getAccount,\"getAccount\");async function submitOptionOrder(params){const url=`${TRADING_BASE_URL}/v2/options/orders`;return alpacaFetch(url,{method:\"POST\",body:JSON.stringify({...params,time_in_force:params.time_in_force??\"day\"})})}__name(submitOptionOrder,\"submitOptionOrder\");async function getOptionOrder(orderId){const url=`${TRADING_BASE_URL}/v2/options/orders/${orderId}`;return alpacaFetch(url)}__name(getOptionOrder,\"getOptionOrder\");async function cancelOptionOrder(orderId){const url=`${TRADING_BASE_URL}/v2/options/orders/${orderId}`;await alpacaFetch(url,{method:\"DELETE\"})}__name(cancelOptionOrder,\"cancelOptionOrder\");function sleep(ms){return new Promise(resolve=>setTimeout(resolve,ms))}__name(sleep,\"sleep\");function parseBarTime(bar){return new Date(bar.t).getTime()}__name(parseBarTime,\"parseBarTime\");0&&(module.exports={cancelOptionOrder,cancelOrder,closePosition,fetchBars,fetchLatestQuote,fetchOptionChain,fetchOptionExpirations,getAccount,getClock,getOptionOrder,getOrder,getPosition,listOpenOrders,parseBarTime,sleep,submitOptionOrder,submitOrder});\n})()\n","warnings":[],"map":{"version":3,"mappings":"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","names":[],"ignoreList":[],"sources":["/Users/coreycosta/trading-agent/lib/alpaca.ts"],"sourcesContent":[null]}}