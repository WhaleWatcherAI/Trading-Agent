{"code":"__filename=\"/Users/coreycosta/trading-agent/lib/gexCalculator.ts\";(()=>{\n\"use strict\";var __create=Object.create;var __defProp=Object.defineProperty;var __getOwnPropDesc=Object.getOwnPropertyDescriptor;var __getOwnPropNames=Object.getOwnPropertyNames;var __getProtoOf=Object.getPrototypeOf;var __hasOwnProp=Object.prototype.hasOwnProperty;var __name=(target,value)=>__defProp(target,\"name\",{value,configurable:true});var __export=(target,all)=>{for(var name in all)__defProp(target,name,{get:all[name],enumerable:true})};var __copyProps=(to,from,except,desc)=>{if(from&&typeof from===\"object\"||typeof from===\"function\"){for(let key of __getOwnPropNames(from))if(!__hasOwnProp.call(to,key)&&key!==except)__defProp(to,key,{get:()=>from[key],enumerable:!(desc=__getOwnPropDesc(from,key))||desc.enumerable})}return to};var __toESM=(mod,isNodeMode,target)=>(target=mod!=null?__create(__getProtoOf(mod)):{},__copyProps(isNodeMode||!mod||!mod.__esModule?__defProp(target,\"default\",{value:mod,enumerable:true}):target,mod));var __toCommonJS=mod=>__copyProps(__defProp({},\"__esModule\",{value:true}),mod);var gexCalculator_exports={};__export(gexCalculator_exports,{calculateGexForSymbol:()=>calculateGexForSymbol});module.exports=__toCommonJS(gexCalculator_exports);var import_axios=__toESM(require(\"axios\"));const TRADIER_API_KEY=process.env.TRADIER_API_KEY||\"\";const TRADIER_BASE_URL=process.env.TRADIER_BASE_URL||\"https://sandbox.tradier.com/v1\";const tradierClient=import_axios.default.create({baseURL:TRADIER_BASE_URL,headers:{Authorization:`Bearer ${TRADIER_API_KEY}`,Accept:\"application/json\"}});const DTE_RANGES={intraday:{min:3,max:7},swing:{min:10,max:20},leaps:{min:45,max:400}};async function calculateGexForSymbol(symbol,mode=\"intraday\",date){console.log(`\\u{1F4CA} Calculating GEX profile for ${symbol} (${mode})${date?` on ${date}`:\"\"}`);let stockPrice;if(date){const historyResponse=await tradierClient.get(\"/markets/history\",{params:{symbol,start:date,end:date}});const history=historyResponse.data?.history?.day;if(!history){throw new Error(`No historical data for ${symbol} on ${date}`)}const bar=Array.isArray(history)?history[0]:history;stockPrice=parseFloat(bar.close)}else{const quoteResponse=await tradierClient.get(\"/markets/quotes\",{params:{symbols:symbol}});const quote=quoteResponse.data?.quotes?.quote;if(!quote){throw new Error(`No quote data returned for ${symbol}`)}stockPrice=parseFloat(quote.last||quote.close||quote.prevclose||0)}if(!Number.isFinite(stockPrice)||stockPrice<=0){throw new Error(`Invalid stock price for ${symbol}`)}const expirationParams={symbol,includeAllRoots:true,strikes:false};const expirationsResponse=await tradierClient.get(\"/markets/options/expirations\",{params:expirationParams});let expirations=expirationsResponse.data?.expirations?.date;if(!expirations||Array.isArray(expirations)&&expirations.length===0){throw new Error(`No options expirations found for ${symbol}`)}if(date){const historicalDate=new Date(date);const expArray=Array.isArray(expirations)?expirations:[expirations];const filteredExps=expArray.filter(expStr=>{const expDate=new Date(expStr);const daysDiff=(expDate.getTime()-historicalDate.getTime())/(1e3*60*60*24);return daysDiff>=0&&daysDiff<=60});console.log(`  Filtered expirations for ${date}: ${filteredExps.length} valid (out of ${expArray.length} total)`);console.log(`  Valid expirations:`,filteredExps.slice(0,5));if(filteredExps.length===0){throw new Error(`No valid expirations found for historical date ${date}`)}expirations=filteredExps}const MS_PER_DAY=1e3*60*60*24;const referenceDate=date?new Date(date):new Date;const todayUTC=Date.UTC(referenceDate.getUTCFullYear(),referenceDate.getUTCMonth(),referenceDate.getUTCDate());const normalizedExpirations=(Array.isArray(expirations)?expirations:[expirations]).map(dateStr=>{const expDate=new Date(`${dateStr}T16:00:00Z`);if(Number.isNaN(expDate.getTime()))return null;const timeDiff=expDate.getTime()-todayUTC;const dte=Math.max(0,Math.round(timeDiff/MS_PER_DAY));return{date:dateStr,expDate,dte}}).filter(item=>!!item).sort((a,b)=>a.expDate.getTime()-b.expDate.getTime());if(normalizedExpirations.length===0){throw new Error(`Unable to normalize expirations for ${symbol}`)}const range=DTE_RANGES[mode];let filtered=normalizedExpirations;if(range){const candidates=normalizedExpirations.filter(({dte})=>dte>=range.min&&dte<=range.max);if(candidates.length>0){filtered=candidates}}const MAX_EXPIRATIONS=3;const selectedExpirations=filtered.slice(0,MAX_EXPIRATIONS);if(selectedExpirations.length===0){throw new Error(`No expirations within configured DTE window for ${symbol} (${mode})`)}const CONTRACT_MULTIPLIER=100;const gexByStrike={};const contracts=[];const expirationTotals={};const dteLookup=Object.fromEntries(selectedExpirations.map(item=>[item.date,item.dte]));for(const{date:expiration}of selectedExpirations){const chainParams={symbol,expiration,greeks:true};if(date){chainParams.date=date}const chainResponse=await tradierClient.get(\"/markets/options/chains\",{params:chainParams});const options=chainResponse.data?.options?.option;if(!options){console.log(`    \\u26A0\\uFE0F  No options data for ${expiration} on ${date||\"current\"}`);continue}const optionsArray=Array.isArray(options)?options:[options];console.log(`    \\u2713 Got ${optionsArray.length} contracts for ${expiration}`);optionsArray.forEach(option=>{const strike=parseFloat(option.strike);const openInterest=parseInt(option.open_interest||0);const gamma=parseFloat(option.greeks?.gamma||0);const optionType=option.option_type;const volume=parseInt(option.volume||0);const last=parseFloat(option.last||0);const bid=parseFloat(option.bid||0);const ask=parseFloat(option.ask||0);const iv=option.greeks?.mid_iv?parseFloat(option.greeks.mid_iv):void 0;if(!Number.isFinite(strike)||strike<=0)return;contracts.push({strike,expiration,type:optionType===\"call\"?\"call\":\"put\",volume,openInterest,last,bid,ask,impliedVol:iv});if(!expirationTotals[expiration]){expirationTotals[expiration]={expiration,dte:dteLookup[expiration]??0,totalCallGex:0,totalPutGex:0,netGex:0,netGexPerDollar:0}}if(!gexByStrike[strike]){gexByStrike[strike]={strike,callGex:0,putGex:0,netGex:0,callGexPerDollar:0,putGexPerDollar:0,netGexPerDollar:0,oi:0,volume:0}}const deltaSharesPerDollar=gamma*openInterest*CONTRACT_MULTIPLIER;const notionalPerDollar=deltaSharesPerDollar*stockPrice;const notionalPerPercent=deltaSharesPerDollar*(stockPrice*stockPrice*.01);if(optionType===\"call\"){const absPercent=Math.abs(notionalPerPercent);const absDollar=Math.abs(notionalPerDollar);gexByStrike[strike].callGex+=absPercent;gexByStrike[strike].callGexPerDollar+=absDollar;gexByStrike[strike].netGex+=notionalPerPercent;gexByStrike[strike].netGexPerDollar+=notionalPerDollar;expirationTotals[expiration].totalCallGex+=absPercent;expirationTotals[expiration].netGex+=notionalPerPercent;expirationTotals[expiration].netGexPerDollar+=notionalPerDollar}else if(optionType===\"put\"){const absPercent=Math.abs(notionalPerPercent);const absDollar=Math.abs(notionalPerDollar);gexByStrike[strike].putGex+=absPercent;gexByStrike[strike].putGexPerDollar+=absDollar;gexByStrike[strike].netGex-=notionalPerPercent;gexByStrike[strike].netGexPerDollar-=notionalPerDollar;expirationTotals[expiration].totalPutGex+=absPercent;expirationTotals[expiration].netGex-=notionalPerPercent;expirationTotals[expiration].netGexPerDollar-=notionalPerDollar}gexByStrike[strike].oi+=openInterest;gexByStrike[strike].volume+=volume})}const gexData=Object.values(gexByStrike).sort((a,b)=>a.strike-b.strike).filter(item=>item.oi>0);if(gexData.length===0){throw new Error(`No valid GEX data for ${symbol}`)}const maxGex=Math.max(...gexData.map(item=>Math.abs(item.netGex)));const gammaWall=gexData.find(item=>Math.abs(item.netGex)===maxGex)?.strike||stockPrice;return{symbol,stockPrice,gexData,gammaWall,maxGex,summary:{totalCallGex:gexData.reduce((sum,item)=>sum+item.callGex,0),totalPutGex:gexData.reduce((sum,item)=>sum+item.putGex,0),netGex:gexData.reduce((sum,item)=>sum+item.netGex,0),totalCallGexPerDollar:gexData.reduce((sum,item)=>sum+item.callGexPerDollar,0),totalPutGexPerDollar:gexData.reduce((sum,item)=>sum+item.putGexPerDollar,0),netGexPerDollar:gexData.reduce((sum,item)=>sum+item.netGexPerDollar,0)},expirations:selectedExpirations.map(({date:date2})=>date2),expirationDetails:selectedExpirations.map(({date:date2,dte})=>({date:date2,dte})),expirationSummaries:selectedExpirations.map(({date:date2})=>expirationTotals[date2]).filter(summary=>Boolean(summary)),source:`Tradier Options Chain (${mode} mode)`,calculatedAt:new Date().toISOString(),contracts}}__name(calculateGexForSymbol,\"calculateGexForSymbol\");0&&(module.exports={calculateGexForSymbol});\n})()\n","warnings":[],"map":{"version":3,"mappings":"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","names":["axios","date"],"ignoreList":[],"sources":["/Users/coreycosta/trading-agent/lib/gexCalculator.ts"],"sourcesContent":[null]}}