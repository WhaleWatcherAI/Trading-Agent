<!DOCTYPE html>
<html>
<head>
    <title>BTC Socket.IO Connection Test</title>
    <script src="https://cdn.socket.io/4.6.1/socket.io.min.js"></script>
    <style>
        body {
            font-family: monospace;
            padding: 20px;
            background: #1a1a1a;
            color: #00ff00;
        }
        .log { margin: 5px 0; }
        .error { color: #ff0000; }
        .success { color: #00ff00; }
        .info { color: #00aaff; }
    </style>
</head>
<body>
    <h1>Socket.IO Connection Test</h1>
    <div id="logs"></div>

    <script>
        const logs = document.getElementById('logs');

        function log(message, type = 'info') {
            const div = document.createElement('div');
            div.className = `log ${type}`;
            div.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            logs.appendChild(div);
            console.log(message);
        }

        log('Connecting to Socket.IO server...', 'info');

        const socket = io('http://localhost:3338', {
            transports: ['websocket', 'polling'],
            reconnection: true
        });

        socket.on('connect', () => {
            log('✓ Socket.IO connected successfully!', 'success');
            log(`Socket ID: ${socket.id}`, 'info');
        });

        socket.on('connect_error', (error) => {
            log(`✗ Connection error: ${error.message}`, 'error');
        });

        socket.on('disconnect', (reason) => {
            log(`✗ Disconnected: ${reason}`, 'error');
        });

        socket.on('candles', (candles) => {
            log(`✓ Received ${candles.length} candles`, 'success');
            if (candles.length > 0) {
                log(`First candle: ${JSON.stringify(candles[0])}`, 'info');
                log(`Last candle: ${JSON.stringify(candles[candles.length - 1])}`, 'info');
            }
        });

        socket.on('orderbook', (data) => {
            if (data && data.bids && data.asks) {
                log(`✓ Received orderbook: ${data.bids.length} bids, ${data.asks.length} asks`, 'success');
                if (data.bids.length > 0) {
                    log(`Best bid: $${data.bids[0][0]} (${data.bids[0][1]} BTC)`, 'info');
                    log(`Lowest bid: $${data.bids[data.bids.length-1][0]} (${data.bids[data.bids.length-1][1]} BTC)`, 'info');
                }
                if (data.asks.length > 0) {
                    log(`Best ask: $${data.asks[0][0]} (${data.asks[0][1]} BTC)`, 'info');
                    log(`Highest ask: $${data.asks[data.asks.length-1][0]} (${data.asks[data.asks.length-1][1]} BTC)`, 'info');
                }
            }
        });

        socket.on('price', (data) => {
            log(`✓ Price update: $${data.price}`, 'success');
        });

        socket.on('trade', (trade) => {
            log(`✓ Trade: ${trade.side} ${trade.size} @ $${trade.price}`, 'info');
        });

        log('Waiting for data...', 'info');
    </script>
</body>
</html>
